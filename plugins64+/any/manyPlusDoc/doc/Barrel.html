<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
	<title>Barrel Function</title>
</head>

<body>
	   <font color="#cc0033"><h1>Barrel </h1></font>
	 
	  <BR><b>Author<a href="../vcmohan.html"> V. C. Mohan</a></b>
	  <BR> Extensively modified on Date 24 oct 2021
	  
	  
	  <p>This plugin corrects Barrel type or Pin Cushion type distortions in 
	  an image that result in due to camera lens projecting image by bending rays unlike iwhat happens in a pinhole camera.. ( The
	  distortions due to perspective are not compensated by this plugin. For
	   correcting perspective distortion one need to use
	    Reform function of this plugin.)
		
		In the test mode a  distorted matrix of dots is overlain on the specified frame. These will be along lines which will be straightened. Best fit parameters can be arrived at. </p>
	  <P><b>Input formats RGB,YUY2, Y or YUV  are acceptable.All bit depths are handled. This function is Thread safe. MT_NICE_FILTER</b></P>
	  <P> A polynomial with 4 coefficients are used to correct. <b>a</b>, <b>b</b>,
	   and <b>c</b> are the
	  coefficients to be specified and the fourth <b>d</b> is computed internally.
	  These parameters mainly depend upon the lens of the camera, focal length of lens 
	  and setting of zoom. Two methods of corrections are implemented. 1.Brown_Conrad and 2. Division method</p> 
	  
	  <p>For many high definition still photographic cameras  databases are
	  available on the web. But for video cams there is no such database. The possible reasons
	  are 1. Video camera resolution is limited 2. The camera and or subjects move 
	  and therefore such distortions are not noticeable. However, due to advent of HD
	  video cams and the consequent increased usage of tripod one may attempt to 
	  correct for such distortions.</p> 	  
	  
	  <P>By the use of test mode the values of coefficients can be arrived at. For a 
	  particular camera and setting of focus, these coefficients will remain same.
	  In test mode the input clip frames are dimmed for better visibility and 
	  overlain with dots which lie along distorted lines. This display may aid
	  in selecting proper coefficients. </P>
	  
	  <BR> Note <b>a + b + c</b> should not exceed <b>1.0 </b>.
	  
	  <BR>After correction one may need to crop image at the edges.
	  
<br><b<u>>Note. This Barrel or Pin cushion distortion correction must be done on
 un cropped image  or on symmetrically cropped image as it assumes the center of distortion to be the center of frame.</u></b>
<table border="2" bordercolorlight="#c0c0c0" bordercolordark="#000000">

<caption align="top">Details of parameters </caption>
<tr>
       <td><b>Description</b></td>
       <td><b>Name</b></td>
       <td><b>Type</b></td>
       <td><b>Limits</b></td>
       <td><b>Default</b></td>
</tr>
<tr>
       <td>Input clip </td>
       <td></td>
       <td>clip</td>
       <td>RGB or planar YUV444 or Y format only</td>
       <td>none</td>
</tr>

<tr>
       <td>coefficient a (xa in independant mode and start val in test mode)</td>
       <td>a</td>
       <td>float</td>
       <td>between  0.0 and 0.5</td>
       <td>0.005</td>
</tr>

<tr>
       <td>coefficient b(xb in independant mode and start val in test mode)</td>
       <td>b</td>
       <td>float</td>
       <td>between  0.0 and 0.5</td>
       <td>0.005</td>
</tr>

<tr>
       <td>coefficient c(xc in independant mode and start val in test mode)</td>
       <td>c</td>
       <td>float</td>
       <td>between 0.0 and 0.5</td>
       <td>0.005</td>
</tr>

<tr>
       <td>whether to correct pin cushion or barrel type distortion</td>
       <td>pin</td>
       <td>Boolean</td>
       <td>true for pin, false for barrel</td>
       <td>false</td>
</tr>

<tr>
       <td>method to be used</td>
       <td>method</td>
       <td>integer</td>
       <td>1 or 2</td>
       <td>1</td>
</tr>
<tr>
       <td>Interpolation scheme</td>
       <td>q</td>
       <td>integer</td>
       <td>1. manipal, 2. bilinear, 3. bicubic 4x4, 4 Lanczos 6X6 4</td>
       <td>1</td>
</tr>

<tr>
       <td>whether in test mode</td>
       <td>test</td>
       <td>Boolean</td>
       <td>true for test, false for normal</td>
       <td>false</td>
</tr>

<tr>
       <td>dimming factor in test mode</td>
       <td>dim</td>
       <td>float</td>
       <td>between 0 and 1.0</td>
       <td>0.5</td>
</tr>


<tr>
       <td>dot density( test mode only)</td>
       <td>dots</td>
       <td>int</td>
       <td>between 1 to 4</td>
       <td>2</td>
</tr>



</table>


<BR>#Usage examples:- 
<pre>
blankclip(width = 720, height = 480, pixel_type = "RGB32",color = $ffffff,  length = 10)
grid()
Barrel(a = 0.005, b = 0.005, c = 0.005,pin = false)
Barrel(a = 0.005, b = 0.005, c = 0.005,pin = true)
 
</pre>
Barrel Distortion Example:-
<BR><img src="./Barrel0.jpeg" border="0"> 

<br>
Pin Cushion Distortion Example
<BR><img src="Pin0.jpeg" border="0">

with following script dots displayed

<br>Barrel(im,a = 0.005, b = 0.005, c = 0.005,pin = false, test = true)


<br><img src="./barreltest0.png" width="648" height="486" border="0">

<br>
<table>

<tr>
       <td><a href="../manyPlus.html">To my index page</a></td>
	   <td>down load<a href="manyPlus.7z">movePlus </a>plugin</td>
       <td><a href="http://www.avisynth.nl">To Avisynth</a> </td>
</tr>
</table>
</body>
</html>

